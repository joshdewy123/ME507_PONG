<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.14.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>ME_507_Ping_Pong_Ball_Launcher: ME 507 - Ping Pong Ball Launcher</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">ME_507_Ping_Pong_Ball_Launcher<span id="projectnumber">&#160;MECHA_02</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.14.0 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search/",'.html');
</script>
<script type="text/javascript">
$(function() { codefold.init(); });
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
$(function(){initNavTree('index.html','',''); });
</script>
<div id="container">
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">ME 507 - Ping Pong Ball Launcher </div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="md__r_e_a_d_m_e"></a></p>
<p><b>Team Members:</b> Josh DeWeese, Nolan Jeung <br  />
 <b>Support:</b> Charlie Refvem, Vincent Ngo, Jason Wong</p>
<hr  />
<p><b>Link to repository:</b> <a href="https://github.com/joshdewy123/ME507_PONG">https://github.com/joshdewy123/ME507_PONG</a></p>
<p><b>Link to video:</b> <a href="https://youtube.com/shorts/3GikZNkVesM?feature=share">https://youtube.com/shorts/3GikZNkVesM?feature=share</a></p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md3"></a>
Overview</h1>
<p>This autonomous ping pong launcher is capable of both manual and automatic targeting and launching. It rotates about two axes to aim, detects objects using a TF-Luna LIDAR, and fires ping pong balls using dual flywheels. The system is built around a custom PCB featuring an STM32 microcontroller, motor drivers, and dedicated I2C lines.</p>
<p>The goal of this project was to create a functional and robust autonomous targeting system while designing and assembling most of the electronics and mechanical components from scratch.</p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md5"></a>
Hardware (Mechanical)</h1>
<p>The robot was designed to use primarily hardware already in our possession in order to be cost-efficient, since the robot was not anticipated to pull extremely heavy loads anyways. The list of actuators and their purposes are below:</p>
<ul>
<li><b>2x Pololu 50:1 Gearmotor (4753):</b> – 12V DC motor with built-in encoders to control the turret/aiming of the robot. Their reasonable size and torque made them a viable choice for this project.</li>
<li><b>2x Maxon DCX 22 mm OD Motors:</b> - 18V DC motor with no external gearbox or sensors. They are able to reach up to about 5000 RPM at nominal speeds, making them a great choice for our flywheels. Despite their nominal voltage of 18V, they were run using 12V instead to limit the necessary power redistribution of our electronics.</li>
<li><b>1x MG90 Servo Motor:</b> - simple 5V servo motor used to control ball loading and launching. Moves to certain angles dependent on the signal sent to it. They were used to push balls forward into the launcher while blocking the next ball from launching at the same time, providing the robot functionality to control when and the quantity of balls launched.</li>
</ul>
<p>The rest of the robot was constructed using a combination of 3-D printed and off-the-shelf components. The robot implements a modular design to allow for easy re-design, removal, and reattachment of components when necessary. Power transfer between the launcher and motors was achieved using belts, pulleys, hand-cut shafts, and bearings. All fasteners are a combination of M2, M2.5, or M3 screws when necessary, and heat-set inserts were used in many locations for ease of assembly and a high overall quality of work.</p>
<p>Small attachment parts were made during the project’s development, and they proved to be very important. First, the flywheels were simply 3-D printed to attach to the Maxon DCX motor’s shaft, as well as be supported by bearings below. Launcher compression was achieved using super-glued foam strips around the wheels. Secondly, the different tensioners were created to improve the grip of the belt-pulley systems. On initial testing, the motors did not have enough tension with the components they were meant to move. Tensioners were added and vastly improved the power transfer of the robot.</p>
<p>Overall, the mechanical design of the robot worked very well. The magazine, launcher, and ball loading mechanism worked especially well. Power transfer between the motors and other components worked well, but over time, the plastic 3-D printed components began losing their grip on the metal shafts, causing more slip over time. If the project were continued with moree time and budget, the robot would utilize more metal mechanical components for longevity.</p>
<div class="image">
<img src="CAD_FULL.png" alt=""/>
<div class="caption">
Full Mechanical System Model</div></div>
    <div class="image">
<img src="CAD_LAUNCHER.png" alt=""/>
<div class="caption">
Launcher Portion of the Mechanical System Model</div></div>
    <hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md7"></a>
Hardware (Electrical)</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md8"></a>
Fusion 360 Schematics</h2>
<div class="image">
<img src="sheet1_me507.png" alt=""/>
<div class="caption">
Power Regulation</div></div>
    <div class="image">
<img src="sheet2_me507.png" alt=""/>
<div class="caption">
MCU Pinouts</div></div>
    <div class="image">
<img src="sheet3_me507.png" alt=""/>
<div class="caption">
Motor Drivers w/ Sensor + Actuator Outputs</div></div>
    <h2 class="doxsection"><a class="anchor" id="autotoc_md9"></a>
Fusion 360 CAD Render</h2>
<div class="image">
<img src="pcb_model.png" alt=""/>
<div class="caption">
PCB CAD Model</div></div>
    <h2 class="doxsection"><a class="anchor" id="autotoc_md10"></a>
Assembled PCB - Before Hotfixes</h2>
<div class="image">
<img src="pcb_before_hotfix.jpg" alt=""/>
<div class="caption">
Before Fix</div></div>
    <h2 class="doxsection"><a class="anchor" id="autotoc_md11"></a>
Assembled PCB - After Hotfixes</h2>
<div class="image">
<img src="pcb_after_hotfix.jpg" alt=""/>
<div class="caption">
After Fix</div></div>
    <p><b>This board includes:</b></p>
<ul>
<li>STM32F411CEU6 microcontroller</li>
<li>DRV8251 motor drivers</li>
<li>Barrel jack for 12V input</li>
<li>5V and 3.3V rails (via Buck and LDO regulators)</li>
<li>I2C, UART, and GPIO breakout headers</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md13"></a>
Roadblocks and Debugging Challenges</h1>
<h2 class="doxsection"><a class="anchor" id="autotoc_md14"></a>
1. <b>Motor Driver Output Failures</b></h2>
<p><b>Issue:</b> Turret motor driver (DRV8251) failed to drive motors consistently.</p>
<p><b>Cause:</b> Missing or insufficient bulk capacitance and improper IPROPI pin handling. <br  />
 <b>Fix:</b></p>
<ul>
<li>Added 0.1 µF and 4.7 µF capacitors to stabilize power rails</li>
<li>Pulled IPROPI to GND through a 1.5kΩ resistor</li>
</ul>
<h3 class="doxsection"><a class="anchor" id="autotoc_md15"></a>
Fusion Schematic Before Fix</h3>
<div class="image">
<img src="motor_driver_before_hotfix.png" alt=""/>
<div class="caption">
Motor Driver Schematic Before</div></div>
    <h3 class="doxsection"><a class="anchor" id="autotoc_md16"></a>
Fusion Schematic After Fix</h3>
<div class="image">
<img src="motor_driver_after_hotfix.png" alt=""/>
<div class="caption">
Motor Driver Schematic After</div></div>
    <hr  />
<h2 class="doxsection"><a class="anchor" id="autotoc_md18"></a>
2. <b>LIDAR Inconsistent I2C Behavior</b></h2>
<p><b>Issue:</b> TF-Luna LIDAR would intermittently drop off the I2C bus. <br  />
 <b>Cause:</b> No pull-up resistors on SDA and SCL lines. <br  />
 <b>Fix:</b> Manually added 10kΩ pull-ups from both lines to 3.3V.</p>
<h3 class="doxsection"><a class="anchor" id="autotoc_md19"></a>
Fusion Schematic Before Fix</h3>
<div class="image">
<img src="lidar_i2c_before_hotfix.png" alt=""/>
<div class="caption">
LIDAR Schematic Before</div></div>
    <h3 class="doxsection"><a class="anchor" id="autotoc_md20"></a>
Fusion Schematic After Fix</h3>
<div class="image">
<img src="lidar_i2c_after_hotfix.png" alt=""/>
<div class="caption">
LIDAR Schematic After</div></div>
    <h3 class="doxsection"><a class="anchor" id="autotoc_md21"></a>
Physical Pull-up Resistor Fix (3 Angles)</h3>
<p><img src="i2c_pull_up_resist_fix_1.jpg" alt="" class="inline" title="Pull-up Fix 1"/>    </p>
<p><br  />
 <img src="i2c_pull_up_resist_fix_2.jpg" alt="" class="inline" title="Pull-up Fix 2"/>    </p>
<p><br  />
 <img src="i2c_pull_up_resist_fix_3.jpg" alt="" class="inline" title="Pull-up Fix 3"/>    </p>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md23"></a>
Software Implementation</h1>
<p>The robot was programmed in C only, as updating the project to C++ caused various issues to occur. The program features a few drivers, a primary main loop, and a finite state machine inside of the main loop. Some primary features of the program include:</p>
<ul>
<li><b>Software PWM:</b> - created due to lack of timers on hardware pins for the servo motor. It functions by setting the pin to high or low depending on the system’s core clock using switch states. While this is not as accurate as hardware PWM, it was OK to use for the servo motor, since its usage was not a primary development focus and it just needed to move back and forth. However, it did cause the program to not support any HAL delays in the main loop or functions due to it causing the servo to move. This function would be removed in future iterations of the robot if possible.</li>
<li><b>Main Loop:</b> - used to run both the finite-state-machine and a few functions that always need to be called for accuracy. The main loop always updates both turret encoders and converts the ticks into degrees. It also updates the servo software pwm. If the BNO055 is implemented, it would also update the euler angles in this portion as well.</li>
<li><b>Finite State Machine:</b> - The FSM has 6 states, also described in the diagram. Entering the commands (COMM) into the console triggers different states.</li>
<li>Initialization, moves the turret motors to a more optimal angle for later movements. See the link: <a href="https://youtube.com/shorts/3GikZNkVesM?feature=share">https://youtube.com/shorts/3GikZNkVesM?feature=share</a></li>
<li>State 1: Hub, waiting for commands to be entered in the PUTTY console</li>
<li>State 2: Aim, moves the turret motors to desired angle</li>
<li>State 3: Lidar, reads the current distance and amp values from the laser sensor</li>
<li>State 4: Fly, spins the flywheel motors to a set duty</li>
<li>State 5: Launch, launches the ball currently loaded in a sequence of movements</li>
<li>State 6: Auto scan, an autonomous routine to scan the area using a set of movements and lidar scan stored data. Scans area, moves to closest distance, launches the ball, then returns to State 1.</li>
</ul>
<div class="image">
<img src="ME507_FSM.png" alt=""/>
<div class="caption">
FSM Diagram</div></div>
    <ul>
<li><b>Commands:</b></li>
<li>M1xx (or M2xx) (S4): sets the duty cycle of the flywheels to the percent hex xx value.</li>
<li>T1xx / T2 xx (S2): sets the desired value for the respective turret to the hex xx value.</li>
<li>LIDA (S3): returns the lidar sensor values: distance (in cm) and amp (determines validity of reading).</li>
<li>SRUN (S5): servo routine to launch the ball.</li>
<li>SCAN (S6): autonomous scan routine</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md25"></a>
Future Work</h1>
<p>If this project were continued, there are multiple fixes to be implemented that would greatly improve the consistency and functionality of the robot:</p>
<ul>
<li><b>Improve material choices and design:</b> - Physical slop between the shafts and 3-D printed components developed over time when operating the robot. By adding more metal components or inserts to connect the shafts to 3-D printed components, the removed slop would improve the encoder angle reading accuracy and ensure proper movement when intended.</li>
<li><b>Review datasheets to optimize PCB design:</b> - Because of the hotfixes implemented to make the motor drivers functional on the PCB, there were more temperature and motor driver overcurrent than intended. This sometimes caused the motors to not run when intended when the robot was left on for extended periods of time. This would also sometimes cause the robot to get stuck in certain states due to not reaching its intended motor angles. If the current sensing resistors and bulk capacitors were more properly implemented into the PCB design, the motor driver would be much more consistent, leading to easier testing and functionality over time.</li>
<li><b>Implement BNO055 (IMU) logic:</b> - Since the IMU is attached to the end of the launching mechanism, its angle readings would be more accurate than the encoder readings. It would also account for the physical slop, which the motors could then compensate for in a control loop. However, even though the IMU was functional, there was not time to implement refined control loops using the IMU readings.</li>
<li><b>Improve UI:</b> - The PUTTY console UI was usable and had all the necessary functionality. However, an actual UI using buttons instead of commands would be more intuitive. Additionally, wireless control would be beneficial for ease of use.</li>
</ul>
<hr  />
<h1 class="doxsection"><a class="anchor" id="autotoc_md27"></a>
Repository Structure</h1>
<div class="fragment"><div class="line">ME507_PONG</div>
<div class="line">├── CAD_MECHANICAL_SYSTEM/      # CAD files for mechanical design</div>
<div class="line">├── Core/                       # Main firmware source code (.c/.h)</div>
<div class="line">├── Drivers/                    # Device drivers (e.g. HAL, custom)</div>
<div class="line">├── Images/                     # Images for Doxygen/README</div>
<div class="line">├── docs/                       # GitHub Pages deployment folder</div>
<div class="line">│   └── index.html              # Doxygen homepage</div>
<div class="line">├── .gitignore                  # Excludes build &amp; local files</div>
<div class="line">├── .project, .cproject         # Eclipse project configs</div>
<div class="line">├── .mxproject                  # STM32CubeMX project file</div>
<div class="line">├── README.md                   # Project overview and documentation</div>
<div class="line">├── STM32F411CEUX_FLASH.ld      # Linker script (FLASH region)</div>
<div class="line">├── STM32F411CEUX_RAM.ld        # Linker script (RAM region)</div>
<div class="line">└── Term_Project_3.ioc          # STM32CubeMX configuration file</div>
</div><!-- fragment --> </div></div><!-- PageDoc -->
<a href="doxygen_crawl.html"></a>
</div><!-- contents -->
</div><!-- doc-content -->
</div><!-- container -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.14.0 </li>
  </ul>
</div>
</body>
</html>
